name: Deploy to Azure Function App using Azure CLI

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    # Checkout the repository
    - name: 'Checkout repository'
      uses: actions/checkout@v2

    # Set up Node.js environment
    - name: 'Set up Node.js'
      uses: actions/setup-node@v3
      with:
        node-version: '20.x' # Specify your node version here

    # Install npm dependencies
    - name: 'Install Dependencies'
      run: npm install

    # Authenticate to Azure using the service principal
    - name: 'Login to Azure'
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    # Zip the function app code (or specific files/folders) for deployment
    - name: 'Create ZIP package for deployment'
      run: zip -r functionapp.zip .

    # Deploy to Azure Function App using az CLI
    - name: 'Deploy to Azure Function App'
      run: |
        az functionapp deployment source config-zip \
          --resource-group DefaultResourceGroup-CCAN \
          --name myNodeFunctionApp1706 \
          --src functionapp.zip
